apiVersion: hypershift.openshift.io/v1alpha1
kind: HostedCluster
metadata:
  name: "{{ metadata.name }}"
  namespace: "{{ metadata.name }}"
spec:
  release:
    image: "{{ edgeCluster.clusterImageSet }}"
  platform:
    type: "Agent"
    agent:
      agentNamespace: "{{ metadata.name }}"
  dns:
    baseDomain: "{{ baseDomain }}"
  networking:
    {{ networking | to_nice_yaml(indent=2) | trim | indent(4) }}
  pullSecret:
    name: assisted-deployment-pull-secret
  sshKey:
    name: "{{ metadata.name }}-sshkey"
  services:
    - service: APIServer
      servicePublishingStrategy:
        type: LoadBalancer
        loadBalancer:
          hostname: "api.{{ metadata.name }}.{{ baseDomain }}"
    - service: OAuthServer
      servicePublishingStrategy:
        type: Route
        route:
          hostname: "oauth-{{ metadata.name }}.{{ ingress.resources[0].spec.domain }}"
    - service: OIDC
      servicePublishingStrategy:
        type: Route
        route:
          hostname: "oidc-{{ metadata.name }}.{{ ingress.resources[0].spec.domain }}"
    - service: Konnectivity
      servicePublishingStrategy:
        type: Route
        route:
          hostname: "konnectivity-{{ metadata.name }}.{{ ingress.resources[0].spec.domain }}"
    - service: Ignition
      servicePublishingStrategy:
        type: Route
        route:
          hostname: "ignition-{{ metadata.name }}.{{ ingress.resources[0].spec.domain }}"
    - service: OVNSbDb
      servicePublishingStrategy:
        type: Route
        route:
          hostname: "ovnsbdb-{{ metadata.name }}.{{ ingress.resources[0].spec.domain }}"
